<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <style>
        .strength-meter {
            margin: 5px 0;
        }
        .strength-label {
            font-size: 12px;
            margin-left: 5px;
        }
        .strength-weak { color: red; }
        .strength-medium { color: orange; }
        .strength-strong { color: green; }
        .strength-very-strong { color: darkgreen; }
        .flash-message {
            color: red;
            font-weight: bold;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <nav>
        <a href="{{ url_for('register') }}">Register</a> |
        <a href="{{ url_for('dashboard') }}">Dashboard</a> |
        <a href="{{ url_for('admin') }}">Admin</a>
    </nav>

    <h2>Login</h2>
    <form method="POST">
        Username: 
        <input type="text" name="username" value="{{ username or '' }}" required><br><br>
        
        Password: 
        <input type="password" name="password" required 
               onkeyup="showPasswordStrength(this.value)"
               oninput="showPasswordStrength(this.value)">
        <br>
        <div class="strength-meter">
            <progress max="4" id="strength" value="0"></progress>
            <span id="strengthText" class="strength-label strength-weak">Very Weak</span>
        </div>

        <!-- Flash messages now appear under the strength meter -->
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            {% for message in messages %}
              <div class="flash-message">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <br><br>
        <button type="submit">Login</button>
    </form>

    <script>
        function showPasswordStrength(password) {
            let strengthBar = document.getElementById("strength");
            let strengthText = document.getElementById("strengthText");

            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]+/)) strength++;
            if (password.match(/[A-Z]+/)) strength++;
            if (password.match(/[0-9]+/)) strength++;
            if (password.match(/[$@#&!]+/)) strength++;

            let displayStrength = Math.min(strength, 4);
            strengthBar.value = displayStrength;

            switch(displayStrength) {
                case 0:
                    strengthText.textContent = "Very Weak";
                    strengthText.className = "strength-label strength-weak";
                    break;
                case 1:
                    strengthText.textContent = "Weak";
                    strengthText.className = "strength-label strength-weak";
                    break;
                case 2:
                    strengthText.textContent = "Medium";
                    strengthText.className = "strength-label strength-medium";
                    break;
                case 3:
                    strengthText.textContent = "Strong";
                    strengthText.className = "strength-label strength-strong";
                    break;
                case 4:
                    strengthText.textContent = "Very Strong âœ“";
                    strengthText.className = "strength-label strength-very-strong";
                    break;
            }
        }

        // Auto-fade flash messages after 3 seconds
        setTimeout(() => {
          document.querySelectorAll('.flash-message').forEach(el => el.remove());
        }, 3000);
    </script>
</body>
</html>
